<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>热评君AI | AI短视频热评</title>
  <meta name="description" content="热评君AI：一键生成适配短视频平台、像真人的高互动热评。支持中/英/乌兹别克语，提供API与商务合作对接。">
  <meta property="og:title" content="热评君AI | AI短视频热评">
  <meta property="og:description" content="一键生成像真人的高互动热评，适配抖音/快手/小红书等平台。">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/logo.svg">
  <link rel="icon" href="/favicon.svg">
  <style>
    :root{--bg1:#0b0f19;--bg2:#0f1630;--card:#121a32;--line:#223;--txt:#eaf0ff;--sub:#a7b5ff;--btn:#5b74ff;--btn2:#7c91ff;--ok:#36d399;--err:#ff6b6b}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--txt);font-family:ui-sans-serif,system-ui,Segoe UI,PingFang SC;-webkit-font-smoothing:antialiased}
    .wrap{max-width:1100px;margin:32px auto;padding:0 18px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{width:40px;height:40px}
    .brand strong{font-size:18px}
    nav select{background:#0c1224;border:1px solid #26304a;color:var(--txt);border-radius:10px;padding:8px 10px}
    h1{font-size:32px;margin:10px 0}
    .lead{color:#c8d2ff99;margin-top:-6px}

    .notice{display:flex;gap:10px;flex-wrap:wrap;align-items:center;background:#0c1224;border:1px solid #26304a;padding:10px 12px;border-radius:12px;margin-top:14px}
    .pill{background:#0d1b3a;border:1px solid #26304a;border-radius:999px;padding:6px 10px;font-size:12px}
    .bar{flex:1;height:10px;background:#0d1430;border-radius:999px;overflow:hidden;border:1px solid #26304a}
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,#5b74ff,#7c91ff);width:0%}

    .grid{display:grid;grid-template-columns:1.2fr 1fr;gap:18px;margin-top:14px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:0 12px 36px rgba(0,0,0,.25)}
    label{display:block;margin:10px 0 6px;color:var(--sub)}
    textarea{width:100%;min-height:140px;border-radius:12px;padding:12px;background:#0c1224;border:1px solid #26304a;color:var(--txt);resize:vertical}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    select,input[type=number],input[type=text]{padding:8px 10px;border-radius:10px;border:1px solid #26304a;background:#0c1224;color:var(--txt)}
    .btn{background:var(--btn);color:#fff;border:none;padding:11px 16px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#0d1b3a;border:1px solid #31406b}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .muted{color:#b8c4ff88;font-size:13px}
    .out{white-space:pre-wrap;background:#0c1224;border:1px solid #26304a;color:var(--txt);border-radius:12px;padding:12px;min-height:60px}
    .ok{color:var(--ok)} .err{color:var(--err)}

    .features{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:8px}
    .tick{color:var(--ok);margin-right:6px}
    .section{margin-top:18px}
    .api pre{background:#0c1224;border:1px solid #26304a;padding:12px;border-radius:12px;overflow:auto}
    footer{margin:28px 0;color:#b8c4ff88;font-size:13px}
    a{color:#b9c3ff}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    input[readonly]{opacity:.9}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <img src="/logo.svg" alt="logo">
        <strong>热评君AI | AI短视频热评</strong>
      </div>
      <nav>
        <select id="lang">
          <option value="zh">中文</option>
          <option value="en">English</option>
          <option value="uz">O‘zbekcha</option>
        </select>
      </nav>
    </header>

    <section>
      <h1 id="hero-title">AI短视频热评</h1>
      <p class="lead" id="hero-sub">一键生成更像“真人热评”的一句话，高共鸣，可直接复制粘贴。</p>

      <!-- 今日用量 & 兑换 -->
      <div class="notice">
        <span class="pill" id="plan-pill">Free</span>
        <div class="bar" title="comments"><span id="barC"></span></div>
        <div class="pill" id="barCtxt">0/0 评论</div>
        <div class="bar" title="images"><span id="barI"></span></div>
        <div class="pill" id="barItxt">0/0 图片</div>
        <input id="redeem" placeholder="输入兑换码升级 PRO" style="min-width:220px">
        <button class="btn secondary" id="btnRedeem">兑换</button>
      </div>
    </section>

    <section class="grid">
      <!-- 抓链 -->
      <div class="card">
        <h3 style="margin-top:0">抓链 · 自动提取视频信息</h3>
        <label for="grabUrl" class="muted">把短链或正文中的链接粘贴到这里（自动识别第一个链接）</label>
        <textarea id="grabUrl" placeholder="例：这条也太好笑了 https://v.douyin.com/xxxxxx/ 快去看！"></textarea>
        <div class="row" style="margin:10px 0">
          <button class="btn" id="btnGrab">抓取信息</button>
          <button class="btn secondary" id="btnGrabClear">清空</button>
        </div>
        <div id="grabOut" class="out" style="min-height:40px"></div>
        <div id="grabThumbWrap" style="margin-top:10px;display:none">
          <img id="grabThumb" alt="cover" style="max-width:100%;border-radius:12px;border:1px solid #26304a">
        </div>

        <!-- 直链区块 -->
        <div id="nowmWrap" style="display:none;margin-top:10px">
          <div class="row">
            <input id="nowmUrl" readonly style="flex:1;min-width:260px" />
            <button class="btn secondary" id="btnCopyNowm">复制直链</button>
            <a class="btn" id="btnDownloadNowm" href="#" target="_blank" rel="noopener">打开/下载</a>
          </div>
          <p class="muted" style="margin-top:6px">提示：直链为系统最佳匹配；若失效，说明平台策略更新，可改用第三方下载工具。</p>
        </div>
      </div>

      <!-- 生成热评 -->
      <div class="card">
        <h3 style="margin-top:0">一键生成热评</h3>
        <label id="label-prompt" for="topic">视频主题关键词</label>
        <textarea id="topic" placeholder="例：兄妹旅游Vlog：第一次潜水拍到海龟；妹妹克服恐惧，兄长鼓励很暖。"></textarea>
        <label for="ctx" class="muted">补充素材（可选）</label>
        <textarea id="ctx" placeholder="可粘贴视频文案、字幕、评论等"></textarea>
        <div class="row" style="margin:12px 0">
          <div>
            <label for="tone">口吻</label>
            <select id="tone">
              <option>简短金句</option><option>轻松有梗</option><option>走心共鸣</option><option>犀利吐槽</option><option>温柔鼓励</option>
            </select>
          </div>
          <div>
            <label for="len">长度</label>
            <select id="len">
              <option>中等</option><option>短句</option><option>长文</option>
            </select>
          </div>
          <div>
            <label for="count">条数</label>
            <input id="count" type="number" value="6" min="1" max="12">
          </div>
          <div>
            <label for="langSel">语言</label>
            <select id="langSel">
              <option value="zh">中文</option><option value="en">English</option><option value="uz">O‘zbekcha</option>
            </select>
          </div>
        </div>
        <button class="btn" id="btnGen">生成热评</button>
        <p class="muted">提示：只需写出片段亮点或情绪点，越具体越好；可先用“抓链”自动带入主题。</p>
        <div id="genOut" class="out" style="margin-top:12px"></div>
      </div>

      <!-- AI 生图 -->
      <div class="card">
        <h3 style="margin-top:0">AI 生图 · 生成封面/主题图</h3>
        <label for="imgPrompt" class="muted">描述你想要的画面（结合视频主题与热评更好）</label>
        <textarea id="imgPrompt" placeholder="例：蓝紫霓虹赛博风，“热评君AI”字样的竖版封面，适合短视频缩略图"></textarea>
        <div class="row" style="margin:10px 0">
          <div>
            <label for="imgSize" class="muted">尺寸</label>
            <select id="imgSize">
              <option>512x512</option><option>768x768</option><option selected>1024x1024</option>
            </select>
          </div>
          <button class="btn" id="btnImg">生成图片</button>
        </div>
        <div id="imgOutWrap" style="display:none;margin-top:10px">
          <img id="imgOut" alt="image" style="max-width:100%;border-radius:12px;border:1px solid #26304a">
        </div>
      </div>

      <!-- 卖点 + 邮箱咨询按钮 -->
      <div class="card">
        <h3 id="feat-title" style="margin-top:0">为什么更像“真人热评”</h3>
        <div class="features">
          <div><span class="tick">✔</span><span id="feat1">语气模板+场景提示，避免口号味</span></div>
          <div><span class="tick">✔</span><span id="feat2">一句话即用，少修饰词，利于上热门</span></div>
          <div><span class="tick">✔</span><span id="feat3">多语种支持：中文 / 英文 / 乌兹别克语</span></div>
          <div><span class="tick">✔</span><span id="feat4">API 接入，便于系统化批量生成</span></div>
        </div>

        <div class="section" style="text-align:center">
          <h4 style="margin:10px 0 14px" id="consult-title">需要正式版 / 团队接入 / API 批量？</h4>
          <a class="btn" href="mailto:yl124915300@gmail.com" id="consult-btn"
             style="display:inline-block;padding:12px 20px;border-radius:12px">
             邮件咨询：yl124915300@gmail.com
          </a>
          <p class="muted" style="margin-top:10px" id="consult-note">
            说明您的业务场景、日调用量级与平台（抖音/快手/小红书…），我们将为您开通更高限额与稳定方案。
          </p>
        </div>
      </div>
    </section>

    <!-- API 简介 -->
    <section class="card section">
      <h3 id="api-title" style="margin-top:0">API（预留，对接更方便）</h3>
      <p class="muted" id="api-tip">后端已部署在 Render，同域即可直接调用：</p>
      <pre><code id="curl">curl -X POST https://YOUR-RENDER.onrender.com/api/generate \
  -H "content-type: application/json" \
  -d '{"topic":"妹妹第一次潜水，哥哥一直鼓励","tone":"走心共鸣","length":"中等","count":6,"lang":"zh"}'</code></pre>
      <p class="muted" id="api-note">返回示例：{"data":["…","…"]}</p>
    </section>

    <footer>
      © <span id="y"></span> 热评君AI | AI短视频热评 ·
      <a href="/healthz" target="_blank">健康检查</a> ·
      <a href="mailto:yl124915300@gmail.com">yl124915300@gmail.com</a>
    </footer>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);
    const setText = (id, v)=>{ const el=$(id); if(el) el.textContent=v; };
    $('y').textContent = new Date().getFullYear();

    // 多语言（简化）
    const i18n = {
      zh:{heroTitle:'AI短视频热评', heroSub:'一键生成更像“真人热评”的一句话，高共鸣，可直接复制粘贴。',
          featTitle:'为什么更像“真人热评”', feat1:'语气模板+场景提示，避免口号味', feat2:'一句话即用，少修饰词，利于上热门',
          feat3:'多语种支持：中文 / 英文 / 乌兹别克语', feat4:'API 接入，便于系统化批量生成',
          apiTitle:'API（预留，对接更方便）', apiTip:'后端已部署在 Render，同域即可直接调用：', apiNote:'返回示例：{"data":["…"]}'},
      en:{heroTitle:'AI Hot Comments', heroSub:'One-click human-like one-liners that spark engagement.',
          featTitle:'Why it feels human', feat1:'Tone patterns & scene hints', feat2:'Paste-ready one sentence',
          feat3:'Multilingual: Chinese / English / Uzbek', feat4:'API for bulk generation',
          apiTitle:'API (ready)', apiTip:'Backend on Render. Call same-origin endpoint:', apiNote:'Response: {"data":["…"]}'},
      uz:{heroTitle:'Qisqa video uchun AI izoh', heroSub:'Bir bosishda tabiiy, odamga o‘xshash bitta jumla.',
          featTitle:'Nega “inson”dek eshitiladi', feat1:'Ohang shablonlari va sahna ko‘rsatmalari', feat2:'Bitta jumla, darhol ishlatish mumkin',
          feat3:'Ko‘p til: Xitoycha / Inglizcha / O‘zbekcha', feat4:'API bilan ommaviy generatsiya',
          apiTitle:'API (tayyor)', apiTip:'Render backend — shu domen orqali chaqiring:', apiNote:'Javob: {"data":["…"]}'}
    };
    function applyLang(L){
      const t=i18n[L]||i18n.zh;
      document.title=`热评君AI | ${t.heroTitle}`; setText('hero-title',t.heroTitle); setText('hero-sub',t.heroSub);
      setText('feat-title',t.featTitle); setText('feat1',t.feat1); setText('feat2',t.feat2); setText('feat3',t.feat3); setText('feat4',t.feat4);
      setText('api-title',t.apiTitle); setText('api-tip',t.apiTip); setText('api-note',t.apiNote);
    }
    const langSel=document.getElementById('lang');
    langSel.value=(navigator.language||'zh').toLowerCase().startsWith('zh')?'zh':(navigator.language||'').toLowerCase().startsWith('uz')?'uz':'en';
    applyLang(langSel.value); langSel.onchange=()=>applyLang(langSel.value);

    // 用量&兑换
    async function refreshQuota(){
      try{
        const r=await fetch('/api/quota'); const j=await r.json();
        const c=j?.daily?.comments||{used:0,total:0}; const i=j?.daily?.images||{used:0,total:0};
        setText('plan-pill', (j.plan||'free').toUpperCase());
        $('barC').style.width = (c.total?Math.min(100,Math.round(c.used/c.total*100)):0)+'%';
        $('barI').style.width = (i.total?Math.min(100,Math.round(i.used/i.total*100)):0)+'%';
        setText('barCtxt', `${c.used}/${c.total} 评论`); setText('barItxt', `${i.used}/${i.total} 图片`);
      }catch(e){}
    }
    refreshQuota();

    $('btnRedeem').onclick=async()=>{
      const code=$('redeem').value.trim(); if(!code) return alert('请输入兑换码');
      const r=await fetch('/api/redeem',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({code})});
      const j=await r.json(); if(!r.ok) return alert(j.error||'兑换失败'); alert('升级成功，已切换到 PRO ✅'); refreshQuota();
    };

    // 抓链
    $('btnGrab').onclick=async()=>{
      $('grabOut').textContent='抓取中…'; $('grabThumbWrap').style.display='none';
      $('nowmWrap').style.display='none'; $('nowmUrl').value='';
      try{
        const raw=$('grabUrl').value||''; const m=String(raw).match(/https?:\/\/[^\s]+/i);
        if(!m) throw new Error('未检测到链接');
        const r=await fetch('/api/grab',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({url:m[0]})});
        const j=await r.json(); if(!r.ok) throw new Error(j.error||'抓链失败');

        $('grabOut').textContent=`平台：${j.platform}\n标题：${j.title||'-'}\n简介：${j.description||'-'}\n链接：${j.finalUrl}`;
        if(j.image){ $('grabThumb').src=j.image; $('grabThumbWrap').style.display=''; }
        if(!$('topic').value && (j.cleanTopic||j.title)) $('topic').value = j.cleanTopic || j.title;

        if (j.nowm) {
          $('nowmUrl').value = j.nowm;
          $('btnDownloadNowm').href = j.nowm;
          $('nowmWrap').style.display='';
        }
      }catch(e){
        $('grabOut').innerHTML='<span class="err">[错误] '+e.message+'</span>';
      }
    };
    $('btnGrabClear').onclick=()=>{ $('grabUrl').value=''; $('grabOut').textContent=''; $('grabThumbWrap').style.display='none'; $('nowmWrap').style.display='none'; };

    // 生成热评
    $('btnGen').onclick=async()=>{
      $('btnGen').disabled=true; $('genOut').textContent='生成中…';
      try{
        const body={
          platform:'douyin', lang: $('langSel').value, tone:$('tone').value,
          count:Number($('count').value||6), length:$('len').value,
          topic:$('topic').value||'', context:$('ctx').value||''
        };
        const r=await fetch('/api/generate',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(body)});
        const j=await r.json();
        if(!r.ok) throw new Error(j.error||'生成失败');
        const lines=(j.data||[]).map(s=>'• '+s).join('\n'); $('genOut').textContent=lines||'(未生成内容)';
      }catch(e){ $('genOut').innerHTML='<span class="err">[错误] '+e.message+'</span>'; }
      finally{ $('btnGen').disabled=false; }
    };

    // 生图
    $('btnImg').onclick=async()=>{
      const base=$('imgPrompt').value||$('topic').value||''; if(!base) return alert('请先填写描述或“视频主题关键词”。');
      $('btnImg').disabled=true; $('imgOutWrap').style.display='none'; $('imgOut').src='';
      try{
        const r=await fetch('/api/image',{method:'POST',headers:{'content-type':'application/json'},
          body:JSON.stringify({prompt:base,size:$('imgSize').value})});
        const j=await r.json(); if(!r.ok) throw new Error(j.error||'生图失败');
        const dataUrl=j.dataUrl||j.data; if(!dataUrl) throw new Error('未拿到图片数据');
        $('imgOut').src=dataUrl; $('imgOutWrap').style.display='';
      }catch(e){ alert('[生图错误] '+e.message); }
      finally{ $('btnImg').disabled=false; }
    };

    // 复制直链
    $('btnCopyNowm').onclick = async () => {
      const v = $('nowmUrl').value; if (!v) return;
      try { await navigator.clipboard.writeText(v); $('btnCopyNowm').textContent = '已复制'; setTimeout(()=> $('btnCopyNowm').textContent='复制直链', 1200); }
      catch { $('nowmUrl').select(); document.execCommand('copy'); }
    };
  </script>
</body>
</html>
